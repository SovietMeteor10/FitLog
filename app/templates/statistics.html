<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats Page - FitLog</title>
    <link rel="stylesheet" href="/static/css/stats_page.css"> <!-- Link to CSS file for consistent theme -->
    <!-- Include Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container stats-page">
        <!-- Sidebar Section -->
        <div class="sidebar">
            <div class="logo-container">
                <img src="/static/images/fitlog_logo.jpg" alt="FitLog Logo" class="logo">
                <h1>FITLOG</h1>
            </div>
        </div>

        <!-- Main Content Section -->
        <div class="content">
            <!-- Navigation Bar -->
            <div class="navbar">
                <div class="nav-links">
                    <a href="/index">Home</a>
                    <a href="/sessions">Sessions</a>
                    <a href="/profile">Profile</a>
                </div>
                <a href="/logout" class="logout-link">Logout</a> <!-- Logout button to the far right -->
            </div>

            <!-- Stats Content --> 
            <div class="dashboard_container">
                <!-- Top Section -->
                <div class="top-section">
                    <!-- Radial Graph (Top Left) -->
                    <div class="graph-container">
                        <h2>Muscle Group Distribution</h2>
                        {{ radial_graph|safe }}
                    </div>
                    
                    <!-- Line Graph (Top Right) -->
                    <div class="graph-container">
                        <h2>Performance Trend</h2>
                        {{ line_graph|safe }}
                    </div>
                </div>
                
                <!-- Bottom Section - Heat Map -->
                <div class="bottom-section">
                    <h2>Activity Heatmap</h2>
                    {{ heatmap|safe }}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fetch recommended videos based on most logged exercises
        async function fetchExerciseBasedVideos() {
            try {
                const response = await fetch('/recommend_videos?user_id=1'); // Replace with dynamic user ID
                const data = await response.json();

                const videoList = document.getElementById('video-list');
                videoList.innerHTML = ''; // Clear existing videos

                data.videos.forEach(video => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <a href="${video.url}" target="_blank">
                            <h4>${video.title}</h4>
                            <p>${video.description}</p>
                        </a>
                    `;
                    videoList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching recommended videos:', error);
            }
        }

        // Fetch recommended videos based on user goal
        async function fetchGoalBasedVideos() {
            try {
                const response = await fetch('/recommend_videos_by_goal?user_id=1'); // Replace with dynamic user ID
                const data = await response.json();

                const goalVideoList = document.createElement('div');
                goalVideoList.innerHTML = `<h3>Videos Based on Your Goal: ${data.goal}</h3>`;
                
                const videoList = document.createElement('ul');
                data.videos.forEach(video => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <a href="${video.url}" target="_blank">
                            <h4>${video.title}</h4>
                            <p>${video.description}</p>
                        </a>
                    `;
                    videoList.appendChild(listItem);
                });
                goalVideoList.appendChild(videoList);
                document.querySelector('.recommended-videos').appendChild(goalVideoList);
            } catch (error) {
                console.error('Error fetching goal-based videos:', error);
            }
        }

        // Populate both video sections on page load
        document.addEventListener('DOMContentLoaded', () => {
            fetchExerciseBasedVideos();
            fetchGoalBasedVideos();
        });
    </script>

    <script src="/static/js/stats.js"></script> <!-- Link to JavaScript file -->
</body>
</html>